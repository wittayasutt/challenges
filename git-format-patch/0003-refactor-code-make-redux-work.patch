From fbc2de5d64a217cd67c34f7955100321d34f61e9 Mon Sep 17 00:00:00 2001
From: wittayasutt <wittayasutt@gmail.com>
Date: Thu, 9 Aug 2018 02:49:51 +0700
Subject: [PATCH 03/12] refactor code / make redux work

---
 db.json                          | 784 +++++++++++++++++++++++++++++++++++----
 src/App.js                       | 109 +-----
 src/components/Title/index.js    |   7 +-
 src/components/cards/card.js     |  67 ++++
 src/components/cards/index.js    |  47 +++
 src/components/cards/payments.js |  24 ++
 src/config/index.js              |   3 +
 src/helpers/index.js             |   2 +-
 src/reducers/index.js            |   4 +-
 9 files changed, 862 insertions(+), 185 deletions(-)
 create mode 100644 src/components/cards/card.js
 create mode 100644 src/components/cards/index.js
 create mode 100644 src/components/cards/payments.js
 create mode 100644 src/config/index.js

diff --git a/db.json b/db.json
index beff703..e75946f 100644
--- a/db.json
+++ b/db.json
@@ -1,78 +1,708 @@
 {
-	"charities": [
-		{
-			"id": 1,
-			"name": "Baan Kru Noi",
-			"image": "baan-kru-noi.jpg",
-			"currency": "THB"
-		},
-		{
-			"id": 2,
-			"name": "Habitat for Humanity Thailand",
-			"image": "habitat-for-humanity-thailand.jpg",
-			"currency": "THB"
-		},
-		{
-			"id": 3,
-			"name": "Paper Ranger",
-			"image": "paper-ranger.jpg",
-			"currency": "THB"
-		},
-		{
-			"id": 4,
-			"name": "Makhampom Theater",
-			"image": "makhampom-theater.jpg",
-			"currency": "THB"
-		},
-		{
-			"id": 5,
-			"name": "Thailand Association of the Blind",
-			"image": "thailand-association-of-the-blind.jpg",
-			"currency": "THB"
-		}
-	],
-	"payments": [
-		{
-			"charitiesId": 2,
-			"amount": 10,
-			"currency": "THB",
-			"id": 1
-		},
-		{
-			"charitiesId": 1,
-			"amount": 20,
-			"currency": "THB",
-			"id": 2
-		},
-		{
-			"charitiesId": 3,
-			"amount": 50,
-			"currency": "THB",
-			"id": 3
-		},
-		{
-			"charitiesId": 4,
-			"amount": 100,
-			"currency": "THB",
-			"id": 4
-		},
-		{
-			"charitiesId": 2,
-			"amount": 500,
-			"currency": "THB",
-			"id": 5
-		},
-		{
-			"charitiesId": 5,
-			"amount": 500,
-			"currency": "THB",
-			"id": 6
-		},
-		{
-			"id": 7
-		},
-		{
-			"id": 8
-		}
-	]
-}
+  "charities": [
+    {
+      "id": 1,
+      "name": "Baan Kru Noi",
+      "image": "baan-kru-noi.jpg",
+      "currency": "THB"
+    },
+    {
+      "id": 2,
+      "name": "Habitat for Humanity Thailand",
+      "image": "habitat-for-humanity-thailand.jpg",
+      "currency": "THB"
+    },
+    {
+      "id": 3,
+      "name": "Paper Ranger",
+      "image": "paper-ranger.jpg",
+      "currency": "THB"
+    },
+    {
+      "id": 4,
+      "name": "Makhampom Theater",
+      "image": "makhampom-theater.jpg",
+      "currency": "THB"
+    },
+    {
+      "id": 5,
+      "name": "Thailand Association of the Blind",
+      "image": "thailand-association-of-the-blind.jpg",
+      "currency": "THB"
+    }
+  ],
+  "payments": [
+    {
+      "charitiesId": 2,
+      "amount": 10,
+      "currency": "THB",
+      "id": 1
+    },
+    {
+      "charitiesId": 1,
+      "amount": 20,
+      "currency": "THB",
+      "id": 2
+    },
+    {
+      "charitiesId": 3,
+      "amount": 50,
+      "currency": "THB",
+      "id": 3
+    },
+    {
+      "charitiesId": 4,
+      "amount": 100,
+      "currency": "THB",
+      "id": 4
+    },
+    {
+      "charitiesId": 2,
+      "amount": 500,
+      "currency": "THB",
+      "id": 5
+    },
+    {
+      "charitiesId": 5,
+      "amount": 500,
+      "currency": "THB",
+      "id": 6
+    },
+    {
+      "id": 7
+    },
+    {
+      "id": 8
+    },
+    {
+      "id": 9
+    },
+    {
+      "id": 10
+    },
+    {
+      "id": 11
+    },
+    {
+      "id": 12
+    },
+    {
+      "id": 13
+    },
+    {
+      "id": 14
+    },
+    {
+      "id": 15
+    },
+    {
+      "id": 16
+    },
+    {
+      "id": 17
+    },
+    {
+      "id": 18
+    },
+    {
+      "id": 19
+    },
+    {
+      "id": 20
+    },
+    {
+      "id": 21
+    },
+    {
+      "id": 22
+    },
+    {
+      "id": 23
+    },
+    {
+      "id": 24
+    },
+    {
+      "id": 25
+    },
+    {
+      "id": 26
+    },
+    {
+      "id": 27
+    },
+    {
+      "id": 28
+    },
+    {
+      "id": 29
+    },
+    {
+      "id": 30
+    },
+    {
+      "id": 31
+    },
+    {
+      "id": 32
+    },
+    {
+      "id": 33
+    },
+    {
+      "id": 34
+    },
+    {
+      "id": 35
+    },
+    {
+      "id": 36
+    },
+    {
+      "id": 37
+    },
+    {
+      "id": 38
+    },
+    {
+      "id": 39
+    },
+    {
+      "id": 40
+    },
+    {
+      "id": 41
+    },
+    {
+      "id": 42
+    },
+    {
+      "id": 43
+    },
+    {
+      "id": 44
+    },
+    {
+      "id": 45
+    },
+    {
+      "id": 46
+    },
+    {
+      "id": 47
+    },
+    {
+      "id": 48
+    },
+    {
+      "id": 49
+    },
+    {
+      "id": 50
+    },
+    {
+      "id": 51
+    },
+    {
+      "id": 52
+    },
+    {
+      "id": 53
+    },
+    {
+      "id": 54
+    },
+    {
+      "id": 55
+    },
+    {
+      "id": 56
+    },
+    {
+      "id": 57
+    },
+    {
+      "id": 58
+    },
+    {
+      "id": 59
+    },
+    {
+      "id": 60
+    },
+    {
+      "id": 61
+    },
+    {
+      "id": 62
+    },
+    {
+      "id": 63
+    },
+    {
+      "id": 64
+    },
+    {
+      "id": 65
+    },
+    {
+      "id": 66
+    },
+    {
+      "id": 67
+    },
+    {
+      "id": 68
+    },
+    {
+      "id": 69
+    },
+    {
+      "id": 70
+    },
+    {
+      "id": 71
+    },
+    {
+      "id": 72
+    },
+    {
+      "id": 73
+    },
+    {
+      "id": 74
+    },
+    {
+      "id": 75
+    },
+    {
+      "id": 76
+    },
+    {
+      "id": 77
+    },
+    {
+      "id": 78
+    },
+    {
+      "id": 79
+    },
+    {
+      "id": 80
+    },
+    {
+      "id": 81
+    },
+    {
+      "id": 82
+    },
+    {
+      "id": 83
+    },
+    {
+      "id": 84
+    },
+    {
+      "id": 85
+    },
+    {
+      "id": 86
+    },
+    {
+      "id": 87
+    },
+    {
+      "id": 88
+    },
+    {
+      "id": 89
+    },
+    {
+      "id": 90
+    },
+    {
+      "id": 91
+    },
+    {
+      "id": 92
+    },
+    {
+      "id": 93
+    },
+    {
+      "id": 94
+    },
+    {
+      "id": 95
+    },
+    {
+      "id": 96
+    },
+    {
+      "id": 97
+    },
+    {
+      "id": 98
+    },
+    {
+      "id": 99
+    },
+    {
+      "id": 100
+    },
+    {
+      "id": 101
+    },
+    {
+      "id": 102
+    },
+    {
+      "id": 103
+    },
+    {
+      "id": 104
+    },
+    {
+      "id": 105
+    },
+    {
+      "id": 106
+    },
+    {
+      "id": 107
+    },
+    {
+      "id": 108
+    },
+    {
+      "id": 109
+    },
+    {
+      "id": 110
+    },
+    {
+      "id": 111
+    },
+    {
+      "id": 112
+    },
+    {
+      "id": 113
+    },
+    {
+      "id": 114
+    },
+    {
+      "id": 115
+    },
+    {
+      "id": 116
+    },
+    {
+      "id": 117
+    },
+    {
+      "id": 118
+    },
+    {
+      "id": 119
+    },
+    {
+      "id": 120
+    },
+    {
+      "id": 121
+    },
+    {
+      "id": 122
+    },
+    {
+      "id": 123
+    },
+    {
+      "id": 124
+    },
+    {
+      "id": 125
+    },
+    {
+      "id": 126
+    },
+    {
+      "id": 127
+    },
+    {
+      "id": 128
+    },
+    {
+      "id": 129
+    },
+    {
+      "id": 130
+    },
+    {
+      "id": 131
+    },
+    {
+      "id": 132
+    },
+    {
+      "id": 133
+    },
+    {
+      "id": 134
+    },
+    {
+      "id": 135
+    },
+    {
+      "id": 136
+    },
+    {
+      "id": 137
+    },
+    {
+      "id": 138
+    },
+    {
+      "id": 139
+    },
+    {
+      "id": 140
+    },
+    {
+      "id": 141
+    },
+    {
+      "id": 142
+    },
+    {
+      "id": 143
+    },
+    {
+      "id": 144
+    },
+    {
+      "id": 145
+    },
+    {
+      "id": 146
+    },
+    {
+      "id": 147
+    },
+    {
+      "id": 148
+    },
+    {
+      "id": 149
+    },
+    {
+      "id": 150
+    },
+    {
+      "id": 151
+    },
+    {
+      "id": 152
+    },
+    {
+      "id": 153
+    },
+    {
+      "id": 154
+    },
+    {
+      "id": 155
+    },
+    {
+      "id": 156
+    },
+    {
+      "id": 157
+    },
+    {
+      "id": 158
+    },
+    {
+      "id": 159
+    },
+    {
+      "id": 160
+    },
+    {
+      "id": 161
+    },
+    {
+      "id": 162
+    },
+    {
+      "id": 163
+    },
+    {
+      "id": 164
+    },
+    {
+      "id": 165
+    },
+    {
+      "id": 166
+    },
+    {
+      "id": 167
+    },
+    {
+      "id": 168
+    },
+    {
+      "id": 169
+    },
+    {
+      "id": 170
+    },
+    {
+      "id": 171
+    },
+    {
+      "id": 172
+    },
+    {
+      "id": 173
+    },
+    {
+      "id": 174
+    },
+    {
+      "id": 175
+    },
+    {
+      "id": 176
+    },
+    {
+      "id": 177
+    },
+    {
+      "id": 178
+    },
+    {
+      "id": 179
+    },
+    {
+      "id": 180
+    },
+    {
+      "id": 181
+    },
+    {
+      "id": 182
+    },
+    {
+      "id": 183
+    },
+    {
+      "id": 184
+    },
+    {
+      "id": 185
+    },
+    {
+      "id": 186
+    },
+    {
+      "id": 187
+    },
+    {
+      "id": 188
+    },
+    {
+      "id": 189
+    },
+    {
+      "id": 190
+    },
+    {
+      "id": 191
+    },
+    {
+      "id": 192
+    },
+    {
+      "id": 193
+    },
+    {
+      "id": 194
+    },
+    {
+      "id": 195
+    },
+    {
+      "id": 196
+    },
+    {
+      "id": 197
+    },
+    {
+      "id": 198
+    },
+    {
+      "id": 199
+    },
+    {
+      "id": 200
+    },
+    {
+      "id": 201
+    },
+    {
+      "id": 202
+    },
+    {
+      "id": 203
+    },
+    {
+      "id": 204
+    },
+    {
+      "id": 205
+    },
+    {
+      "id": 206
+    },
+    {
+      "id": 207
+    },
+    {
+      "id": 208
+    },
+    {
+      "id": 209
+    },
+    {
+      "id": 210
+    },
+    {
+      "id": 211
+    },
+    {
+      "id": 212
+    },
+    {
+      "id": 213
+    },
+    {
+      "id": 214
+    },
+    {
+      "id": 215
+    },
+    {
+      "id": 216
+    },
+    {
+      "id": 217
+    },
+    {
+      "id": 218
+    }
+  ]
+}
\ No newline at end of file
diff --git a/src/App.js b/src/App.js
index 8b8bf6b..ca6dc5a 100644
--- a/src/App.js
+++ b/src/App.js
@@ -1,119 +1,20 @@
 import React, { Component } from 'react'
-import { connect } from 'react-redux'
 import styled from 'styled-components'
-import fetch from 'isomorphic-fetch'
-
-import { summaryDonations } from './helpers'
 
 import Title from './components/title'
+import Cards from './components/cards'
 
-const Card = styled.div`
-	margin: 10px;
-	border: 1px solid #ccc;
-`
+const Container = styled.div``
 
 class App extends Component {
-	constructor(props) {
-		super()
-
-		this.state = {
-			charities: [],
-			selectedAmount: 10
-		}
-	}
-
-	componentDidMount() {
-		const self = this
-		fetch('http://localhost:3001/charities')
-			.then(function(resp) {
-				return resp.json()
-			})
-			.then(function(data) {
-				self.setState({ charities: data })
-			})
-
-		fetch('http://localhost:3001/payments')
-			.then(function(resp) {
-				return resp.json()
-			})
-			.then(function(data) {
-				self.props.dispatch({
-					type: 'UPDATE_TOTAL_DONATE',
-					amount: summaryDonations(data.map(item => item.amount))
-				})
-			})
-	}
-
 	render() {
-		const self = this
-		const cards = this.state.charities.map(function(item, i) {
-			const payments = [10, 20, 50, 100, 500].map((amount, j) => (
-				<label key={j}>
-					<input
-						type="radio"
-						name="payment"
-						onClick={function() {
-							self.setState({ selectedAmount: amount })
-						}}
-					/>{' '}
-					{amount}
-				</label>
-			))
-
-			return (
-				<Card key={i}>
-					<p>{item.name}</p>
-					{payments}
-					<button
-						onClick={handlePay.call(
-							self,
-							item.id,
-							self.state.selectedAmount,
-							item.currency
-						)}>
-						Pay
-					</button>
-				</Card>
-			)
-		})
-
 		return (
-			<div className="container">
+			<Container className="container">
 				<Title />
-				{cards}
-			</div>
+				<Cards />
+			</Container>
 		)
 	}
 }
 
 export default App
-
-function handlePay(id, amount, currency) {
-	const self = this
-	return function() {
-		fetch('http://localhost:3001/payments', {
-			method: 'POST',
-			body: `{ "charitiesId": ${id}, "amount": ${amount}, "currency": "${currency}" }`
-		})
-			.then(function(resp) {
-				return resp.json()
-			})
-			.then(function() {
-				self.props.dispatch({
-					type: 'UPDATE_TOTAL_DONATE',
-					amount
-				})
-				self.props.dispatch({
-					type: 'UPDATE_MESSAGE',
-					message: `Thanks for donate ${amount}!`
-				})
-
-				setTimeout(function() {
-					self.props.dispatch({
-						type: 'UPDATE_MESSAGE',
-						message: ''
-					})
-				}, 2000)
-			})
-	}
-}
diff --git a/src/components/Title/index.js b/src/components/Title/index.js
index bf696de..bcfe316 100644
--- a/src/components/Title/index.js
+++ b/src/components/Title/index.js
@@ -15,4 +15,9 @@ class Title extends Component {
 	}
 }
 
-export default connect(state => state)(Title)
+const mapStateToProps = state => ({
+	donate: state.donate,
+	message: state.messagee
+})
+
+export default connect(mapStateToProps)(Title)
diff --git a/src/components/cards/card.js b/src/components/cards/card.js
new file mode 100644
index 0000000..ce92477
--- /dev/null
+++ b/src/components/cards/card.js
@@ -0,0 +1,67 @@
+import React, { Component } from 'react'
+import { bindActionCreators } from 'redux'
+import { connect } from 'react-redux'
+import styled from 'styled-components'
+import fetch from 'isomorphic-fetch'
+
+import { updateTotalDonate, updateMessage } from '../../actions'
+
+import Payments from './payments'
+
+const Wrapper = styled.div`
+	margin: 10px;
+	border: 1px solid #ccc;
+`
+
+class Card extends Component {
+	constructor(props) {
+		super()
+
+		this.state = {
+			selectedAmount: 10
+		}
+
+		this.handleSetAmount = this.handleSetAmount.bind(this)
+		this.handlePay = this.handlePay.bind(this)
+	}
+
+	handleSetAmount(amout) {
+		this.setState({ selectedAmount: amout })
+	}
+
+	handlePay(id, amount, currency) {
+		fetch('http://localhost:3001/payments', {
+			method: 'POST',
+			body: `{ "charitiesId": ${id}, "amount": ${amount}, "currency": "${currency}" }`
+		})
+			.then(resp => resp.json())
+			.then(() => {
+				this.props.updateTotalDonate(amount)
+				this.props.updateMessage(`Thanks for donate ${amount}!`)
+				setTimeout(() => {
+					this.props.updateMessage(``)
+				}, 2000)
+			})
+	}
+
+	render() {
+		const { item } = this.props
+		const { selectedAmount } = this.state
+
+		return (
+			<Wrapper>
+				<p>{item.name}</p>
+				<Payments setAmount={this.handleSetAmount} />
+				<button
+					onClick={this.handlePay(item.id, selectedAmount, item.currency)}>
+					Pay
+				</button>
+			</Wrapper>
+		)
+	}
+}
+
+const mapDispatchToProps = dispatch =>
+	bindActionCreators({ updateTotalDonate, updateMessage }, dispatch)
+
+export default connect(null, mapDispatchToProps)(Card)
diff --git a/src/components/cards/index.js b/src/components/cards/index.js
new file mode 100644
index 0000000..fb52b44
--- /dev/null
+++ b/src/components/cards/index.js
@@ -0,0 +1,47 @@
+import React, { Component } from 'react'
+import { bindActionCreators } from 'redux'
+import { connect } from 'react-redux'
+import styled from 'styled-components'
+import fetch from 'isomorphic-fetch'
+
+import { updateTotalDonate } from '../../actions'
+import { summaryDonations } from '../../helpers'
+
+import Card from './card'
+
+class Cards extends Component {
+	constructor(props) {
+		super()
+
+		this.state = {
+			charities: []
+		}
+	}
+
+	componentDidMount() {
+		fetch('http://localhost:3001/charities')
+			.then(resp => resp.json())
+			.then(data => {
+				this.setState({ charities: data })
+			})
+
+		fetch('http://localhost:3001/payments')
+			.then(resp => resp.json())
+			.then(data => {
+				this.props.updateTotalDonate(
+					summaryDonations(data.map(item => item.amount))
+				)
+			})
+	}
+
+	render() {
+		const { charities } = this.state
+
+		return charities.map((item, index) => <Card key={index} item={item} />)
+	}
+}
+
+const mapDispatchToProps = dispatch =>
+	bindActionCreators({ updateTotalDonate }, dispatch)
+
+export default connect(null, mapDispatchToProps)(Cards)
diff --git a/src/components/cards/payments.js b/src/components/cards/payments.js
new file mode 100644
index 0000000..6511e98
--- /dev/null
+++ b/src/components/cards/payments.js
@@ -0,0 +1,24 @@
+import React, { Component } from 'react'
+import styled from 'styled-components'
+import config from '../../config'
+
+class Payments extends Component {
+	render() {
+		const { payment } = config
+
+		const payments = payment.map((amount, index) => (
+			<label key={index}>
+				<input
+					type="radio"
+					name="payment"
+					onClick={() => this.props.setAmount(amount)}
+				/>
+				{amount}
+			</label>
+		))
+
+		return <div>{payments}</div>
+	}
+}
+
+export default Payments
diff --git a/src/config/index.js b/src/config/index.js
new file mode 100644
index 0000000..6402486
--- /dev/null
+++ b/src/config/index.js
@@ -0,0 +1,3 @@
+export default {
+	payment: [10, 20, 50, 100, 500]
+}
diff --git a/src/helpers/index.js b/src/helpers/index.js
index 632afb1..bcdf51c 100644
--- a/src/helpers/index.js
+++ b/src/helpers/index.js
@@ -1,2 +1,2 @@
 export const summaryDonations = danations =>
-	danations.reduce((accumulator, value) => accumulator + value)
+	danations.reduce((accumulator, value) => accumulator + (value ? value : 0))
diff --git a/src/reducers/index.js b/src/reducers/index.js
index 54cd4a4..8e7cf3e 100644
--- a/src/reducers/index.js
+++ b/src/reducers/index.js
@@ -1,14 +1,14 @@
 export const donateReducer = (state = 0, action) => {
 	switch (action.type) {
 		case 'UPDATE_TOTAL_DONATE': {
-			return state + action.donate
+			return state + action.amount
 		}
 		default:
 			return state
 	}
 }
 
-export const messageReducer = (state = '1sdsd', action) => {
+export const messageReducer = (state = '', action) => {
 	switch (action.type) {
 		case 'UPDATE_MESSAGE': {
 			return action.message
-- 
2.8.1.windows.1

